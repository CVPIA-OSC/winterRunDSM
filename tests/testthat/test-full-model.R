library(testthat)
library(winterRunDSM)

# Model seeds -----
expected_model_seeds <- structure(c(6646, 0, 4670, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 5912, 0, 4441, 
                                    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                    0, 0, 0, 0, 0, 0, 0, 2427, 0, 1705, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 87, 
                                    0, 32, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                    0, 0, 0, 0, 0, 0, 0, 0, 0, 0), .Dim = c(31L, 25L), .Dimnames = list(
                                      c("Upper Sacramento River", "Antelope Creek", "Battle Creek", 
                                        "Bear Creek", "Big Chico Creek", "Butte Creek", "Clear Creek", 
                                        "Cottonwood Creek", "Cow Creek", "Deer Creek", "Elder Creek", 
                                        "Mill Creek", "Paynes Creek", "Stony Creek", "Thomes Creek", 
                                        "Upper-mid Sacramento River", "Sutter Bypass", "Bear River", 
                                        "Feather River", "Yuba River", "Lower-mid Sacramento River", 
                                        "Yolo Bypass", "American River", "Lower Sacramento River", 
                                        "Calaveras River", "Cosumnes River", "Mokelumne River", "Merced River", 
                                        "Stanislaus River", "Tuolumne River", "San Joaquin River"
                                      ), NULL))

expected_model_seeds_stoch <- structure(c(6646, 0, 4670, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                          0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 5912, 0, 4441, 
                                          0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                          0, 0, 0, 0, 0, 0, 0, 2427, 0, 1705, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                          0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 87, 
                                          0, 32, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                          0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                          0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                          0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                          0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                          0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                          0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                          0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                          0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                          0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                          0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                          0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                          0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                          0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                          0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                          0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                          0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                          0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                          0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                          0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                          0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                          0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                          0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                          0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                          0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                          0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                          0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                          0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                          0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                          0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                          0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                          0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                          0, 0, 0, 0, 0, 0, 0, 0, 0, 0), .Dim = c(31L, 25L), .Dimnames = list(
                                            c("Upper Sacramento River", "Antelope Creek", "Battle Creek", 
                                              "Bear Creek", "Big Chico Creek", "Butte Creek", "Clear Creek", 
                                              "Cottonwood Creek", "Cow Creek", "Deer Creek", "Elder Creek", 
                                              "Mill Creek", "Paynes Creek", "Stony Creek", "Thomes Creek", 
                                              "Upper-mid Sacramento River", "Sutter Bypass", "Bear River", 
                                              "Feather River", "Yuba River", "Lower-mid Sacramento River", 
                                              "Yolo Bypass", "American River", "Lower Sacramento River", 
                                              "Calaveras River", "Cosumnes River", "Mokelumne River", "Merced River", 
                                              "Stanislaus River", "Tuolumne River", "San Joaquin River"
                                            ), NULL))


test_that("model seed returns correct data structure (deterministic)", {
  model_seed <- winter_run_model(mode = "seed")
  
  expect_equal(dim(model_seed), c(31, 25)) # correct dims
  expect_equal(rownames(model_seed), winterRunDSM::watershed_labels) # has labels
  expect_equal(sum(model_seed[,5:25]), 0) # contains just seed data
})

test_that("model seed returns correct values (deterministic)", {
  model_seed <- winter_run_model(mode = "seed")
  
  expect_equal(model_seed, expected_model_seeds)
})

test_that("model seed returns correct data structure (stochastic)", {
  set.seed(2021)
  model_seed <- winter_run_model(mode = "seed")
  
  expect_equal(dim(model_seed), c(31, 25)) # correct dims
  expect_equal(rownames(model_seed), winterRunDSM::watershed_labels) # has labels
  expect_equal(sum(model_seed[,5:25]), 0) # contains just seed data
})

test_that("model seed returns correct values (stochastic)", {
  set.seed(2021)
  model_seed <- winter_run_model(mode = "seed")
  
  expect_equal(model_seed, expected_model_seeds_stoch)
})


# Model Simulation -----------------

expected_model_sim <- list(spawners = structure(c(4042, 0, 3780, 0, 0, 0, 0, 0, 0, 
                                                  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                  0, 3634, 0, 3594, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1736, 0, 1398, 0, 0, 0, 
                                                  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                  0, 0, 0, 0, 1886, 0, 702, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 3704, 0, 2474, 
                                                  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                  0, 0, 0, 0, 0, 0, 0, 3752, 0, 3554, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2908, 
                                                  0, 2330, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1734, 0, 734, 0, 0, 0, 0, 0, 0, 
                                                  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                  0, 950, 0, 278, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 660, 0, 156, 0, 0, 0, 
                                                  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                  0, 0, 0, 0, 456, 0, 78, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 492, 0, 96, 0, 0, 
                                                  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                  0, 0, 0, 0, 0, 422, 0, 48, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 358, 0, 4, 0, 
                                                  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                  0, 0, 0, 0, 0, 0, 372, 0, 8, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 384, 0, 12, 
                                                  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                  0, 0, 0, 0, 0, 0, 0, 408, 0, 6, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 456, 0, 
                                                  6, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                  0, 0, 0, 0, 0, 0, 0, 0, 616, 0, 6, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 798, 
                                                  0, 8, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                  0, 0, 0, 0, 0, 0, 0, 0, 0), .Dim = c(31L, 20L), .Dimnames = list(
                                                    c("Upper Sacramento River", "Antelope Creek", "Battle Creek", 
                                                      "Bear Creek", "Big Chico Creek", "Butte Creek", "Clear Creek", 
                                                      "Cottonwood Creek", "Cow Creek", "Deer Creek", "Elder Creek", 
                                                      "Mill Creek", "Paynes Creek", "Stony Creek", "Thomes Creek", 
                                                      "Upper-mid Sacramento River", "Sutter Bypass", "Bear River", 
                                                      "Feather River", "Yuba River", "Lower-mid Sacramento River", 
                                                      "Yolo Bypass", "American River", "Lower Sacramento River", 
                                                      "Calaveras River", "Cosumnes River", "Mokelumne River", "Merced River", 
                                                      "Stanislaus River", "Tuolumne River", "San Joaquin River"
                                                    ), c("1", "2", "3", "4", "5", "6", "7", "8", "9", "10", "11", 
                                                         "12", "13", "14", "15", "16", "17", "18", "19", "20"))), 
                           juvenile_biomass = structure(c(44772.2, 0, 13403.2, 0, 0, 
                                                          0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                          0, 0, 0, 0, 0, 0, 0, 1372119.4, 0, 420559.7, 0, 0, 0, 0, 
                                                          0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                          0, 0, 0, 0, 0, 606874.5, 0, 1000561.2, 0, 0, 0, 0, 0, 0, 
                                                          0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                          0, 0, 0, 770753, 0, 302350.1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                          0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                          38567.5, 0, 10353.1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                          0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 986378.1, 
                                                          0, 302543.5, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                          0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 23613.1, 0, 9431.3, 
                                                          0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                          0, 0, 0, 0, 0, 0, 0, 0, 0, 16903.1, 0, 10801.5, 0, 0, 0, 
                                                          0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                          0, 0, 0, 0, 0, 0, 36266.8, 0, 16000.5, 0, 0, 0, 0, 0, 0, 
                                                          0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                          0, 0, 0, 8144.4, 0, 2145.2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                          0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1189.1, 
                                                          0, 354.5, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                          0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 17132.1, 0, 4100.2, 0, 
                                                          0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                          0, 0, 0, 0, 0, 0, 0, 0, 62408.6, 0, 11593.4, 0, 0, 0, 0, 
                                                          0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                          0, 0, 0, 0, 0, 3140.9, 0, 31.4, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                          0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                          94414.3, 0, 2626.2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                          0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 85339.7, 0, 
                                                          2931.1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                          0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 190015.5, 0, 2763.2, 0, 
                                                          0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                          0, 0, 0, 0, 0, 0, 0, 0, 132858.8, 0, 1800.7, 0, 0, 0, 0, 
                                                          0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                          0, 0, 0, 0, 0, 235689.3, 0, 2292.2, 0, 0, 0, 0, 0, 0, 0, 
                                                          0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                          0, 0, 223291.3, 0, 1821.2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                          0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0), .Dim = c(31L, 
                                                                                                                          20L), 
                                                        .Dimnames = list(c("Upper Sacramento River", "Antelope Creek", 
                                                                           "Battle Creek", "Bear Creek", "Big Chico Creek", "Butte Creek", 
                                                                           "Clear Creek", "Cottonwood Creek", "Cow Creek", "Deer Creek", 
                                                                           "Elder Creek", "Mill Creek", "Paynes Creek", "Stony Creek", 
                                                                           "Thomes Creek", "Upper-mid Sacramento River", "Sutter Bypass", 
                                                                           "Bear River", "Feather River", "Yuba River", "Lower-mid Sacramento River", 
                                                                           "Yolo Bypass", "American River", "Lower Sacramento River", 
                                                                           "Calaveras River", "Cosumnes River", "Mokelumne River", "Merced River", 
                                                                           "Stanislaus River", "Tuolumne River", "San Joaquin River"
                                                        ), c("1", "2", "3", "4", "5", "6", "7", "8", "9", "10", "11", 
                                                             "12", "13", "14", "15", "16", "17", "18", "19", "20"))), 
                           proportion_natural = structure(c(0.914893617021277, 0, 1, 
                                                            0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                            0, 0, 0, 0, 0, 0, 0, 0, 0, 0.905338470005504, 0, 1, 0, 0, 
                                                            0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                            0, 0, 0, 0, 0, 0, 0, 0.80184331797235, 0, 1, 0, 0, 0, 0, 
                                                            0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                            0, 0, 0, 0, 0, 0.817603393425239, 0, 1, 0, 0, 0, 0, 0, 0, 
                                                            0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                            0, 0, 0, 0.907127429805616, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                            0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                            0, 0.908315565031983, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                            0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.881705639614856, 
                                                            0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                            0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.80161476355248, 0, 1, 
                                                            0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                            0, 0, 0, 0, 0, 0, 0, 0, 0, 0.637894736842105, 0, 1, 0, 0, 
                                                            0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                            0, 0, 0, 0, 0, 0, 0, 0.478787878787879, 0, 1, 0, 0, 0, 0, 
                                                            0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                            0, 0, 0, 0, 0, 0.245614035087719, 0, 1, 0, 0, 0, 0, 0, 0, 
                                                            0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                            0, 0, 0, 0.300813008130081, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                            0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                            0, 0.184834123222749, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                            0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.0391061452513966, 
                                                            0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                            0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.0752688172043011, 0, 1, 
                                                            0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                            0, 0, 0, 0, 0, 0, 0, 0, 0, 0.104166666666667, 0, 1, 0, 0, 
                                                            0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                            0, 0, 0, 0, 0, 0, 0, 0.156862745098039, 0, 1, 0, 0, 0, 0, 
                                                            0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                            0, 0, 0, 0, 0, 0.245614035087719, 0, 1, 0, 0, 0, 0, 0, 0, 
                                                            0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                            0, 0, 0, 0.441558441558442, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                            0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                            0, 0.568922305764411, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                            0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0), .Dim = c(31L, 
                                                                                                                            20L), 
                                                          .Dimnames = list(c("Upper Sacramento River", "Antelope Creek", 
                                                                             "Battle Creek", "Bear Creek", "Big Chico Creek", "Butte Creek", 
                                                                             "Clear Creek", "Cottonwood Creek", "Cow Creek", "Deer Creek", 
                                                                             "Elder Creek", "Mill Creek", "Paynes Creek", "Stony Creek", 
                                                                             "Thomes Creek", "Upper-mid Sacramento River", "Sutter Bypass", 
                                                                             "Bear River", "Feather River", "Yuba River", "Lower-mid Sacramento River", 
                                                                             "Yolo Bypass", "American River", "Lower Sacramento River", 
                                                                             "Calaveras River", "Cosumnes River", "Mokelumne River", "Merced River", 
                                                                             "Stanislaus River", "Tuolumne River", "San Joaquin River"
                                                          ), c("1", "2", "3", "4", "5", "6", "7", "8", "9", "10", "11", 
                                                               "12", "13", "14", "15", "16", "17", "18", "19", "20"))), 
                           viability_metrics = structure(c(0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                           0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 1, 0, 0, 0, 1, 0, 0, 0, 
                                                           0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                           0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                           0, 0, 0, 0, 0, 0, 0, 0, 0, 0), .Dim = c(19L, 4L)))

expected_model_sim_stoch <- list(spawners = structure(c(4056, 0, 3776, 0, 0, 0, 0, 0, 0, 
                                                        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                        0, 3581, 0, 3569, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1726, 0, 1376, 0, 0, 0, 
                                                        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                        0, 0, 0, 0, 441, 0, 841, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1937, 0, 2601, 
                                                        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                        0, 0, 0, 0, 0, 0, 0, 3588, 0, 3350, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2452, 
                                                        0, 2410, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 878, 0, 894, 0, 0, 0, 0, 0, 0, 
                                                        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                        0, 678, 0, 314, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 349, 0, 181, 0, 0, 0, 
                                                        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                        0, 0, 0, 0, 604, 0, 28, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 645, 0, 23, 0, 0, 
                                                        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                        0, 0, 0, 0, 0, 451, 0, 15, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 297, 0, 7, 0, 
                                                        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                        0, 0, 0, 0, 0, 0, 402, 0, 6, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 286, 0, 4, 
                                                        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                        0, 0, 0, 0, 0, 0, 0, 391, 0, 6, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 478, 0, 
                                                        11, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                        0, 0, 0, 0, 0, 0, 0, 0, 0, 653, 0, 8, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 846, 
                                                        0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                        0, 0, 0, 0, 0, 0, 0, 0, 0), .Dim = c(31L, 20L), .Dimnames = list(
                                                          c("Upper Sacramento River", "Antelope Creek", "Battle Creek", 
                                                            "Bear Creek", "Big Chico Creek", "Butte Creek", "Clear Creek", 
                                                            "Cottonwood Creek", "Cow Creek", "Deer Creek", "Elder Creek", 
                                                            "Mill Creek", "Paynes Creek", "Stony Creek", "Thomes Creek", 
                                                            "Upper-mid Sacramento River", "Sutter Bypass", "Bear River", 
                                                            "Feather River", "Yuba River", "Lower-mid Sacramento River", 
                                                            "Yolo Bypass", "American River", "Lower Sacramento River", 
                                                            "Calaveras River", "Cosumnes River", "Mokelumne River", "Merced River", 
                                                            "Stanislaus River", "Tuolumne River", "San Joaquin River"
                                                          ), c("1", "2", "3", "4", "5", "6", "7", "8", "9", "10", "11", 
                                                               "12", "13", "14", "15", "16", "17", "18", "19", "20"))), 
                                 juvenile_biomass = structure(c(5941.4, 0, 4587.1, 0, 0, 0, 
                                                                0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                                0, 0, 0, 0, 0, 0, 104728.1, 0, 511208.3, 0, 0, 0, 0, 0, 0, 
                                                                0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                                0, 0, 0, 2072556, 0, 892154.4, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                                0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                                283887.4, 0, 431378.2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                                0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 25611, 0, 
                                                                7116.4, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                                0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 72675.5, 0, 63688.3, 0, 
                                                                0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                                0, 0, 0, 0, 0, 0, 0, 0, 1377.5, 0, 7826.7, 0, 0, 0, 0, 0, 
                                                                0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                                0, 0, 0, 0, 4617.6, 0, 4527.5, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                                0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                                98457.7, 0, 3944.1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                                0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 7022.2, 0, 2285.8, 
                                                                0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                                0, 0, 0, 0, 0, 0, 0, 0, 0, 1135.4, 0, 9.1, 0, 0, 0, 0, 0, 
                                                                0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                                0, 0, 0, 0, 5025.8, 0, 1099, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                                0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 4427.4, 
                                                                0, 879.2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                                0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 879.2, 0, 62.8, 0, 0, 
                                                                0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                                0, 0, 0, 0, 0, 0, 0, 87140.9, 0, 4804.2, 0, 0, 0, 0, 0, 0, 
                                                                0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                                0, 0, 0, 9523.3, 0, 376.8, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                                0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 216584, 
                                                                0, 188.4, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                                0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 92141.7, 0, 1413, 0, 
                                                                0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                                0, 0, 0, 0, 0, 0, 0, 0, 277387.6, 0, 1381.6, 0, 0, 0, 0, 
                                                                0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                                0, 0, 0, 0, 0, 70345.1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                                0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0), .Dim = c(31L, 
                                                                                                                                   20L), .Dimnames = list(c("Upper Sacramento River", "Antelope Creek", 
                                                                                                                                                            "Battle Creek", "Bear Creek", "Big Chico Creek", "Butte Creek", 
                                                                                                                                                            "Clear Creek", "Cottonwood Creek", "Cow Creek", "Deer Creek", 
                                                                                                                                                            "Elder Creek", "Mill Creek", "Paynes Creek", "Stony Creek", 
                                                                                                                                                            "Thomes Creek", "Upper-mid Sacramento River", "Sutter Bypass", 
                                                                                                                                                            "Bear River", "Feather River", "Yuba River", "Lower-mid Sacramento River", 
                                                                                                                                                            "Yolo Bypass", "American River", "Lower Sacramento River", 
                                                                                                                                                            "Calaveras River", "Cosumnes River", "Mokelumne River", "Merced River", 
                                                                                                                                                            "Stanislaus River", "Tuolumne River", "San Joaquin River"
                                                                                                                                   ), c("1", "2", "3", "4", "5", "6", "7", "8", "9", "10", "11", 
                                                                                                                                        "12", "13", "14", "15", "16", "17", "18", "19", "20"))), 
                                 proportion_natural = structure(c(0.912475345167653, 0, 1, 
                                                                  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                                  0, 0, 0, 0, 0, 0, 0, 0, 0, 0.926836079307456, 0, 1, 0, 0, 
                                                                  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                                  0, 0, 0, 0, 0, 0, 0, 0.789107763615295, 0, 1, 0, 0, 0, 0, 
                                                                  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                                  0, 0, 0, 0, 0, 0.414965986394558, 0, 1, 0, 0, 0, 0, 0, 0, 
                                                                  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                                  0, 0, 0, 0.830665978316985, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                                  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                                  0, 0.899108138238573, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                                  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.853181076672104, 
                                                                  0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                                  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.608200455580866, 0, 1, 
                                                                  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                                  0, 0, 0, 0, 0, 0, 0, 0, 0, 0.399705014749263, 0, 1, 0, 0, 
                                                                  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                                  0, 0, 0, 0, 0, 0, 0, 0.303724928366762, 0, 1, 0, 0, 0, 0, 
                                                                  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                                  0, 0, 0, 0, 0, 0.236754966887417, 0, 1, 0, 0, 0, 0, 0, 0, 
                                                                  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                                  0, 0, 0, 0.449612403100775, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                                  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                                  0, 0.381374722838137, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                                  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.0471380471380471, 
                                                                  0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                                  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.054726368159204, 0, 1, 
                                                                  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                                  0, 0, 0, 0, 0, 0, 0, 0, 0, 0.0314685314685315, 0, 1, 0, 0, 
                                                                  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                                  0, 0, 0, 0, 0, 0, 0, 0.184143222506394, 0, 1, 0, 0, 0, 0, 
                                                                  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                                  0, 0, 0, 0, 0, 0.290794979079498, 0, 1, 0, 0, 0, 0, 0, 0, 
                                                                  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                                  0, 0, 0, 0.335375191424196, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                                  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                                  0, 0.472813238770686, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                                  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0), .Dim = c(31L, 
                                                                                                                                  20L), .Dimnames = list(c("Upper Sacramento River", "Antelope Creek", 
                                                                                                                                                           "Battle Creek", "Bear Creek", "Big Chico Creek", "Butte Creek", 
                                                                                                                                                           "Clear Creek", "Cottonwood Creek", "Cow Creek", "Deer Creek", 
                                                                                                                                                           "Elder Creek", "Mill Creek", "Paynes Creek", "Stony Creek", 
                                                                                                                                                           "Thomes Creek", "Upper-mid Sacramento River", "Sutter Bypass", 
                                                                                                                                                           "Bear River", "Feather River", "Yuba River", "Lower-mid Sacramento River", 
                                                                                                                                                           "Yolo Bypass", "American River", "Lower Sacramento River", 
                                                                                                                                                           "Calaveras River", "Cosumnes River", "Mokelumne River", "Merced River", 
                                                                                                                                                           "Stanislaus River", "Tuolumne River", "San Joaquin River"
                                                                                                                                  ), c("1", "2", "3", "4", "5", "6", "7", "8", "9", "10", "11", 
                                                                                                                                       "12", "13", "14", "15", "16", "17", "18", "19", "20"))), 
                                 viability_metrics = structure(c(0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                                 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 1, 1, 0, 0, 1, 1, 0, 0, 
                                                                 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                                 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                                 0, 0, 0, 0, 0, 0, 0, 0, 0, 0), .Dim = c(19L, 4L)))

test_that("model simulation returns correct data structure and values (determenistic)", {
  model_sim <- winter_run_model(seeds = expected_model_seeds, mode = "simulate")
  
  expect_equal(length(model_sim), 4)
  expect_equal(names(model_sim), c("spawners", "juvenile_biomass", "proportion_natural", "viability_metrics"))
  expect_equal(dim(model_sim$spawners), c(31, 20))
  expect_equal(dim(model_sim$juvenile_biomass), c(31, 20))
  expect_equal(dim(model_sim$proportion_natural), c(31, 20))
  
  # correct values
  expect_equal(model_sim, expected_model_sim)
})


test_that("model simulation returns correct data structure and values (stochastic)", {
  set.seed(2021)
  model_sim <- winter_run_model(seeds = expected_model_seeds, mode = "simulate", 
                                stochastic = TRUE)
  
  expect_equal(length(model_sim), 4)
  expect_equal(names(model_sim), c("spawners", "juvenile_biomass", "proportion_natural", "viability_metrics"))
  expect_equal(dim(model_sim$spawners), c(31, 20))
  expect_equal(dim(model_sim$juvenile_biomass), c(31, 20))
  expect_equal(dim(model_sim$proportion_natural), c(31, 20))
  
  # correct values
  expect_equal(model_sim, expected_model_sim_stoch)
})




